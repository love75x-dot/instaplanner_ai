<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insta Feed Master 2.0 - AI ì¸ìŠ¤íƒ€ê·¸ë¨ ìº¡ì…˜ ìƒì„±ê¸°</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">

    <style>
        * {
            font-family: 'Pretendard', 'Inter', sans-serif;
        }

        /* Instagram Gradient */
        .instagram-gradient {
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
        }

        /* Glassmorphism Effect */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* iPhone Mockup Styles */
        .iphone-frame {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 40px;
            padding: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .iphone-notch {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 210px;
            height: 30px;
            background: #000;
            border-radius: 0 0 20px 20px;
            z-index: 10;
        }

        .iphone-screen {
            width: 100%;
            height: 100%;
            background: #fff;
            border-radius: 32px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* Custom Scrollbar */
        .iphone-screen::-webkit-scrollbar {
            width: 4px;
        }

        .iphone-screen::-webkit-scrollbar-track {
            background: transparent;
        }

        .iphone-screen::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 10px;
        }

        /* Loading Animation */
        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-left-color: #dc2743;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(100px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Drag & Drop Area */
        .drag-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }

        .drag-area.dragover {
            border-color: #dc2743;
            background: rgba(220, 39, 67, 0.05);
        }

        /* Button Hover Effects */
        .btn-primary {
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(220, 39, 67, 0.3);
        }

        /* Instagram Post Image */
        .insta-post-img {
            width: 100%;
            aspect-ratio: 1 / 1;
            object-fit: cover;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .iphone-frame {
                width: 320px;
                height: 693px;
            }
        }

        @media (max-width: 768px) {
            .iphone-frame {
                width: 100%;
                max-width: 375px;
                height: auto;
                aspect-ratio: 375 / 812;
            }
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="instagram-gradient w-12 h-12 rounded-2xl flex items-center justify-center">
                        <i class="fab fa-instagram text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Insta Feed Master</h1>
                        <p class="text-sm text-gray-500">AI ìº¡ì…˜ & í•´ì‹œíƒœê·¸ ìƒì„±ê¸°</p>
                    </div>
                </div>
                <button onclick="openSettings()" class="p-3 rounded-xl hover:bg-gray-100 transition">
                    <i class="fas fa-cog text-gray-600 text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- Left Panel: Control Panel -->
            <div class="space-y-6">

                <!-- Image Upload Area -->
                <div class="bg-white rounded-3xl shadow-lg p-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">
                        <i class="fas fa-image mr-2 text-pink-500"></i>
                        ì´ë¯¸ì§€ ì—…ë¡œë“œ
                    </h2>
                    <div id="dropArea"
                        class="drag-area rounded-2xl p-12 text-center cursor-pointer bg-gray-50 hover:bg-gray-100 transition">
                        <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600 font-medium mb-2">ì‚¬ì§„ì„ ì—¬ê¸°ì— ë†“ìœ¼ì„¸ìš”</p>
                        <p class="text-sm text-gray-400">ë˜ëŠ” í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</p>
                        <input type="file" id="fileInput" accept="image/*" class="hidden">
                    </div>
                </div>

                <!-- Options -->
                <div class="bg-white rounded-3xl shadow-lg p-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">
                        <i class="fas fa-sliders-h mr-2 text-purple-500"></i>
                        ì˜µì…˜ ì„¤ì •
                    </h2>

                    <!-- Mood Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">ë¶„ìœ„ê¸°</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="relative">
                                <input type="radio" name="mood" value="ê°ì„±ì ì¸" checked class="peer hidden">
                                <div
                                    class="border-2 border-gray-200 peer-checked:border-pink-500 peer-checked:bg-pink-50 rounded-xl p-3 cursor-pointer transition text-center">
                                    <i class="fas fa-heart text-pink-500"></i>
                                    <span class="block text-sm font-medium mt-1">ê°ì„±ì ì¸</span>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="mood" value="ìœ ë¨¸ëŸ¬ìŠ¤í•œ" class="peer hidden">
                                <div
                                    class="border-2 border-gray-200 peer-checked:border-yellow-500 peer-checked:bg-yellow-50 rounded-xl p-3 cursor-pointer transition text-center">
                                    <i class="fas fa-laugh text-yellow-500"></i>
                                    <span class="block text-sm font-medium mt-1">ìœ ë¨¸ëŸ¬ìŠ¤í•œ</span>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="mood" value="ì „ë¬¸ì ì¸" class="peer hidden">
                                <div
                                    class="border-2 border-gray-200 peer-checked:border-blue-500 peer-checked:bg-blue-50 rounded-xl p-3 cursor-pointer transition text-center">
                                    <i class="fas fa-briefcase text-blue-500"></i>
                                    <span class="block text-sm font-medium mt-1">ì „ë¬¸ì ì¸</span>
                                </div>
                            </label>
                            <label class="relative">
                                <input type="radio" name="mood" value="ë‹´ë°±í•œ" class="peer hidden">
                                <div
                                    class="border-2 border-gray-200 peer-checked:border-gray-500 peer-checked:bg-gray-50 rounded-xl p-3 cursor-pointer transition text-center">
                                    <i class="fas fa-align-left text-gray-500"></i>
                                    <span class="block text-sm font-medium mt-1">ë‹´ë°±í•œ</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Language Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">ì–¸ì–´</label>
                        <select id="language"
                            class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:border-pink-500 transition">
                            <option value="í•œêµ­ì–´">í•œêµ­ì–´</option>
                            <option value="ì˜ì–´">ì˜ì–´</option>
                            <option value="í•œì˜í˜¼ìš©">í•œì˜ í˜¼ìš©</option>
                        </select>
                    </div>

                    <!-- TMI Input -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">ì˜¤ëŠ˜ì˜ TMI (ì„ íƒì‚¬í•­)</label>
                        <textarea id="tmiInput" rows="3" placeholder="ì˜ˆ: ì¹œêµ¬ì™€ í™ëŒ€ì—ì„œ ì €ë… ë¨¹ì—ˆì–´ìš”"
                            class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:border-pink-500 transition resize-none"></textarea>
                    </div>
                </div>

                <!-- Generate Button -->
                <button onclick="generateCaption()"
                    class="btn-primary w-full instagram-gradient text-white font-semibold py-4 rounded-2xl shadow-lg flex items-center justify-center space-x-2">
                    <i class="fas fa-magic"></i>
                    <span>âœ¨ ë§¤ì§ ìƒì„±í•˜ê¸°</span>
                </button>

                <!-- AI Consulting Box -->
                <div id="consultingBox"
                    class="hidden bg-gradient-to-r from-purple-50 to-pink-50 rounded-3xl shadow-lg p-6 border-2 border-purple-200">
                    <h3 class="text-lg font-semibold text-purple-900 mb-3">
                        <i class="fas fa-lightbulb mr-2"></i>
                        AI ì»¨ì„¤íŒ…
                    </h3>
                    <p id="aiTip" class="text-purple-800"></p>
                </div>

                <!-- Fixed Hashtags Settings -->
                <div class="bg-white rounded-3xl shadow-lg p-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4">
                        <i class="fas fa-hashtag mr-2 text-blue-500"></i>
                        ê³ ì • í•´ì‹œíƒœê·¸
                    </h2>
                    <p class="text-sm text-gray-500 mb-4">ìì£¼ ì‚¬ìš©í•˜ëŠ” í•´ì‹œíƒœê·¸ë¥¼ ì €ì¥í•˜ì„¸ìš” (ê³µë°±ìœ¼ë¡œ êµ¬ë¶„)</p>
                    <div class="flex space-x-2">
                        <input type="text" id="fixedHashtags" placeholder="ì˜ˆ: #ë°ì¼ë¦¬ #ë§íŒ”"
                            class="flex-1 border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:border-blue-500 transition">
                        <button onclick="saveFixedHashtags()"
                            class="bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition">
                            <i class="fas fa-save"></i>
                        </button>
                    </div>
                </div>

                <!-- Copy Buttons -->
                <div id="copyButtons" class="hidden grid grid-cols-3 gap-3">
                    <button onclick="copyText('caption')"
                        class="bg-white hover:bg-gray-50 border-2 border-gray-200 text-gray-700 font-medium py-3 rounded-xl transition">
                        <i class="fas fa-copy mr-1"></i>
                        ìº¡ì…˜ë§Œ
                    </button>
                    <button onclick="copyText('hashtags')"
                        class="bg-white hover:bg-gray-50 border-2 border-gray-200 text-gray-700 font-medium py-3 rounded-xl transition">
                        <i class="fas fa-hashtag mr-1"></i>
                        íƒœê·¸ë§Œ
                    </button>
                    <button onclick="copyText('all')"
                        class="bg-gradient-to-r from-purple-500 to-pink-500 text-white font-medium py-3 rounded-xl hover:shadow-lg transition">
                        <i class="fas fa-file-alt mr-1"></i>
                        ì „ì²´
                    </button>
                </div>

            </div>

            <!-- Right Panel: iPhone Mockup Preview -->
            <div class="flex items-start justify-center sticky top-24">
                <div class="iphone-frame relative">
                    <div class="iphone-notch"></div>
                    <div class="iphone-screen">

                        <!-- Instagram Header -->
                        <div class="p-3 border-b border-gray-200 flex items-center justify-between bg-white">
                            <div class="flex items-center space-x-3">
                                <div class="instagram-gradient w-10 h-10 rounded-full flex items-center justify-center">
                                    <i class="fab fa-instagram text-white text-sm"></i>
                                </div>
                                <span class="font-semibold text-sm">InstaPlanner</span>
                            </div>
                            <i class="fas fa-ellipsis-v text-gray-600"></i>
                        </div>

                        <!-- Post Image -->
                        <div id="previewImageContainer" class="bg-gray-100 flex items-center justify-center"
                            style="aspect-ratio: 1/1;">
                            <div class="text-center text-gray-400">
                                <i class="fas fa-image text-6xl mb-3"></i>
                                <p class="text-sm">ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                            </div>
                        </div>

                        <!-- Interaction Icons -->
                        <div class="p-3 flex items-center justify-between bg-white">
                            <div class="flex items-center space-x-4">
                                <i class="far fa-heart text-2xl"></i>
                                <i class="far fa-comment text-2xl"></i>
                                <i class="far fa-paper-plane text-2xl"></i>
                            </div>
                            <i class="far fa-bookmark text-2xl"></i>
                        </div>

                        <!-- Likes -->
                        <div class="px-3 pb-2 bg-white">
                            <p class="font-semibold text-sm">ì¢‹ì•„ìš” 1,234ê°œ</p>
                        </div>

                        <!-- Caption & Hashtags -->
                        <div id="captionArea" class="px-3 pb-3 bg-white">
                            <p class="text-sm text-gray-400">
                                AIê°€ ìƒì„±í•œ ìº¡ì…˜ê³¼ í•´ì‹œíƒœê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                            </p>
                        </div>

                        <!-- Comments Preview -->
                        <div class="px-3 pb-3 bg-white border-b border-gray-200">
                            <p class="text-sm text-gray-400">ëŒ“ê¸€ 45ê°œ ëª¨ë‘ ë³´ê¸°</p>
                        </div>

                        <!-- Time -->
                        <div class="px-3 py-2 bg-white">
                            <p class="text-xs text-gray-400">5ë¶„ ì „</p>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Settings Modal -->
    <div id="settingsModal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 animate-fadeIn">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-900">
                    <i class="fas fa-key mr-2 text-pink-500"></i>
                    API Key ì„¤ì •
                </h2>
                <button onclick="closeSettings()" class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">Google Gemini API Key</label>
                <input type="password" id="apiKeyInput" placeholder="AIza..."
                    class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:border-pink-500 transition">
                <p class="text-xs text-gray-500 mt-2">
                    <i class="fas fa-info-circle mr-1"></i>
                    API í‚¤ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ë©° ì™¸ë¶€ë¡œ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
                </p>
            </div>

            <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-4 mb-6">
                <p class="text-sm text-blue-800 mb-2">
                    <i class="fas fa-lightbulb mr-1"></i>
                    Google AI Studioì—ì„œ ë¬´ë£Œë¡œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
                </p>
                <a href="https://aistudio.google.com/app/apikey" target="_blank"
                    class="text-sm text-blue-600 hover:underline">
                    â†’ API í‚¤ ë°œê¸‰ë°›ê¸°
                </a>
            </div>

            <button onclick="saveApiKey()"
                class="w-full instagram-gradient text-white font-semibold py-3 rounded-xl hover:shadow-lg transition">
                <i class="fas fa-save mr-2"></i>
                ì €ì¥í•˜ê¸°
            </button>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-3xl shadow-2xl p-8 text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-gray-700 font-medium">AIê°€ ë§ˆë²•ì„ ë¶€ë¦¬ëŠ” ì¤‘...</p>
            <p class="text-sm text-gray-500 mt-2">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” âœ¨</p>
        </div>
    </div>

    <script>
        // Global Variables
        let uploadedImage = null;
        let uploadedImageMimeType = 'image/jpeg'; // Default MIME type
        let generatedCaption = '';
        let generatedHashtags = '';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadApiKey();
            loadFixedHashtags();
            setupDragAndDrop();
        });

        // Drag & Drop Setup
        function setupDragAndDrop() {
            const dropArea = document.getElementById('dropArea');
            const fileInput = document.getElementById('fileInput');

            dropArea.addEventListener('click', () => fileInput.click());

            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.classList.add('dragover');
            });

            dropArea.addEventListener('dragleave', () => {
                dropArea.classList.remove('dragover');
            });

            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0]);
                }
            });
        }

        // Handle File Upload
        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                showToast('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤', 'error');
                return;
            }

            // Save MIME type for API call
            uploadedImageMimeType = file.type;

            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedImage = e.target.result;
                updatePreviewImage(uploadedImage);
                showToast('ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤ âœ“', 'success');
            };
            reader.readAsDataURL(file);
        }

        // Update Preview Image
        function updatePreviewImage(imageSrc) {
            const container = document.getElementById('previewImageContainer');
            container.innerHTML = `<img src="${imageSrc}" class="insta-post-img" alt="Preview">`;
        }

        // Settings Modal
        function openSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        // API Key Management
        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (!apiKey) {
                showToast('API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            localStorage.setItem('gemini_api_key', apiKey);
            showToast('API Keyê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ âœ“', 'success');
            closeSettings();
        }

        function loadApiKey() {
            const apiKey = localStorage.getItem('gemini_api_key');
            if (apiKey) {
                document.getElementById('apiKeyInput').value = apiKey;
            }
        }

        function getApiKey() {
            return localStorage.getItem('gemini_api_key');
        }

        // Fixed Hashtags Management
        function saveFixedHashtags() {
            const hashtags = document.getElementById('fixedHashtags').value.trim();
            localStorage.setItem('fixed_hashtags', hashtags);
            showToast('ê³ ì • í•´ì‹œíƒœê·¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ âœ“', 'success');
        }

        function loadFixedHashtags() {
            const hashtags = localStorage.getItem('fixed_hashtags');
            if (hashtags) {
                document.getElementById('fixedHashtags').value = hashtags;
            }
        }

        function getFixedHashtags() {
            return localStorage.getItem('fixed_hashtags') || '';
        }

        // Generate Caption with Gemini API
        async function generateCaption() {
            // Validation
            const apiKey = getApiKey();
            if (!apiKey) {
                showToast('ë¨¼ì € API Keyë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”', 'error');
                openSettings();
                return;
            }

            if (!uploadedImage) {
                showToast('ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            // Get options
            const mood = document.querySelector('input[name="mood"]:checked').value;
            const language = document.getElementById('language').value;
            const tmi = document.getElementById('tmiInput').value.trim();

            // Show loading
            showLoading();

            try {
                // Prepare image (remove data:image/jpeg;base64, prefix)
                const base64Image = uploadedImage.split(',')[1];

                // Build prompt
                let prompt = `ë„ˆëŠ” ì¸ìŠ¤íƒ€ê·¸ë¨ ì¸í”Œë£¨ì–¸ì„œì•¼. ì´ ì‚¬ì§„ì„ ë³´ê³  ${mood} í†¤ìœ¼ë¡œ ì‘ì„±í•´ì¤˜.\n`;
                prompt += `ì–¸ì–´: ${language}\n`;
                if (tmi) {
                    prompt += `ì¶”ê°€ ì •ë³´: ${tmi}\n`;
                }
                prompt += `\nìš”êµ¬ì‚¬í•­:\n`;
                prompt += `1. ë§¤ë ¥ì ì¸ ìº¡ì…˜ 1ê°œ ì‘ì„± (2-3ë¬¸ì¥, ì´ëª¨ì§€ í¬í•¨)\n`;
                prompt += `2. ìœ ì…ì„ ë¶€ë¥´ëŠ” í•´ì‹œíƒœê·¸ 25ê°œ ì‘ì„±\n`;
                prompt += `3. ì´ ì‚¬ì§„ì˜ ì¥ë¥´ë¥¼ ë¶„ì„í•´ì„œ ì—…ë¡œë“œ ê¿€íŒì„ í•œ ì¤„ë¡œ ì‘ì„±\n\n`;
                prompt += `ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•´ì¤˜:\n`;
                prompt += `{\n  "caption": "ìº¡ì…˜ ë‚´ìš©",\n  "hashtags": "#íƒœê·¸1 #íƒœê·¸2 ...",\n  "tip": "ê¿€íŒ ë‚´ìš©"\n}`;

                // Call Gemini API
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: prompt },
                                {
                                    inline_data: {
                                        mime_type: uploadedImageMimeType,
                                        data: base64Image
                                    }
                                }
                            ]
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('API Error Response:', errorData);
                    console.error('Status:', response.status, response.statusText);

                    let errorMessage = 'API ì˜¤ë¥˜';
                    if (response.status === 400) {
                        errorMessage = 'API Keyê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì„¤ì •ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    } else if (response.status === 429) {
                        errorMessage = 'API í• ë‹¹ëŸ‰ ì´ˆê³¼. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    } else if (response.status === 403) {
                        errorMessage = 'API Key ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. Keyë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
                    } else if (errorData.error?.message) {
                        errorMessage = errorData.error.message;
                    }

                    throw new Error(errorMessage);
                }

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;

                // Parse JSON response
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (!jsonMatch) {
                    throw new Error('ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨');
                }

                const result = JSON.parse(jsonMatch[0]);

                // Add fixed hashtags
                const fixedHashtags = getFixedHashtags();
                if (fixedHashtags) {
                    result.hashtags += ' ' + fixedHashtags;
                }

                // Save results
                generatedCaption = result.caption;
                generatedHashtags = result.hashtags;

                // Update UI
                updateCaptionDisplay(result.caption, result.hashtags);
                updateConsultingBox(result.tip);

                // Show copy buttons
                document.getElementById('copyButtons').classList.remove('hidden');

                hideLoading();
                showToast('ìƒì„± ì™„ë£Œ! ğŸ‰', 'success');

            } catch (error) {
                hideLoading();
                console.error('======= ì—ëŸ¬ ë°œìƒ =======');
                console.error('Error:', error);
                console.error('Error Message:', error.message);
                console.error('=========================');

                // ë” êµ¬ì²´ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€
                let userMessage = 'ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';

                if (error.message.includes('API Key')) {
                    userMessage = error.message;
                } else if (error.message.includes('API ì˜¤ë¥˜') || error.message.includes('í• ë‹¹ëŸ‰')) {
                    userMessage = error.message;
                } else if (error.message.includes('íŒŒì‹±')) {
                    userMessage = 'AI ì‘ë‹µ ì²˜ë¦¬ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    console.error('ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì„ í™•ì¸í•˜ì—¬ ìì„¸í•œ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                } else if (error.message.includes('candidates')) {
                    userMessage = 'AIê°€ ì‘ë‹µì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ë‚˜ ì„¤ì •ì„ ë³€ê²½í•´ë³´ì„¸ìš”.';
                } else if (error.message.includes('fetch')) {
                    userMessage = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                } else {
                    userMessage = error.message + ' (F12 ì½˜ì†” í™•ì¸)';
                }

                showToast(userMessage, 'error');
            }
        }

        // Update Caption Display
        function updateCaptionDisplay(caption, hashtags) {
            const captionArea = document.getElementById('captionArea');
            captionArea.innerHTML = `
                <p class="text-sm">
                    <span class="font-semibold">InstaPlanner</span>
                    <span class="ml-1">${caption}</span>
                </p>
                <p class="text-sm text-blue-600 mt-2">${hashtags}</p>
            `;
        }

        // Update Consulting Box
        function updateConsultingBox(tip) {
            const consultingBox = document.getElementById('consultingBox');
            const aiTip = document.getElementById('aiTip');
            aiTip.textContent = tip;
            consultingBox.classList.remove('hidden');
        }

        // Copy Functions
        function copyText(mode) {
            let textToCopy = '';

            switch (mode) {
                case 'caption':
                    textToCopy = generatedCaption;
                    break;
                case 'hashtags':
                    textToCopy = generatedHashtags;
                    break;
                case 'all':
                    textToCopy = generatedCaption + '\n\n' + generatedHashtags;
                    break;
            }

            navigator.clipboard.writeText(textToCopy).then(() => {
                showToast('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤ âœ“', 'success');
            }).catch(() => {
                showToast('ë³µì‚¬ ì‹¤íŒ¨', 'error');
            });
        }

        // Loading Overlay
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        // Toast Notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = 'toast';

            const icon = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';
            const color = type === 'success' ? 'text-green-400' : type === 'error' ? 'text-red-400' : 'text-blue-400';

            toast.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas ${icon} ${color}"></i>
                    <span>${message}</span>
                </div>
            `;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>

</body>

</html>